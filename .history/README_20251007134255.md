# my-espeak

An Emacs package that provides text-to-speech functionality with support for both eSpeak and Microsoft Edge TTS engines. Read text aloud from any buffer, including PDFs, with intelligent text processing and cleanup.

## Features

- **Dual TTS Engines**: Choose between eSpeak (lightweight) or Edge TTS (high-quality voices)
- **Smart Text Processing**: Handles hyphen-split words, ligatures, and formatting cleanup
- **PDF Support**: Works seamlessly with `pdf-view-mode` 
- **Region or Buffer Reading**: Read selected text or from cursor to end of buffer
- **Toggle Controls**: Easy start/stop with F9 (eSpeak) and F10 (Edge TTS)
- **Audio Player Detection**: Automatically finds the best available audio player

## Installation

### Prerequisites

#### For eSpeak (Required)
```bash
# Ubuntu/Debian
sudo apt install espeak

# macOS
brew install espeak

# Arch Linux
sudo pacman -S espeak
```

#### For Edge TTS (Optional, for high-quality voices)
```bash
pip install edge-tts
```

#### Audio Players
The package will automatically detect and use one of these audio players:
- `paplay` (PulseAudio - most Linux distributions)
- `ffplay` (part of FFmpeg)
- `mplayer`
- `vlc`
- `aplay` (ALSA)

### Package Installation

1. Download `my-espeak.el` to your Emacs configuration directory
2. Add to your `init.el`:

```elisp
(load-path "path/to/my-espeak.el")
(require 'espeak)
```

Or if using `use-package`:

```elisp
(use-package espeak
  :load-path "path/to/my-espeak.el"
  :bind (("<f9>" . my/toggle-read-aloud-espeak)
         ("<f10>" . my/toggle-read-aloud-fancy)))
```

## Usage

### Basic Commands

| Key     | Command                        | Description                           |
|---------|--------------------------------|---------------------------------------|
| `F9`    | `my/toggle-read-aloud-espeak`  | Start/stop reading with eSpeak       |
| `F10`   | `my/toggle-read-aloud-fancy`   | Start/stop reading with Edge TTS     |

### Reading Modes

The package intelligently determines what to read based on context:

1. **Selected Text**: If you have an active region, it reads the selected text
2. **From Cursor**: If no selection, reads from cursor position to end of buffer
3. **PDF Pages**: In `pdf-view-mode`, reads the current page or selected text

### Text Processing Features

- **Hyphen Cleanup**: Joins words split across lines (e.g., "deal-\ning" → "dealing")
- **Ligature Normalization**: Converts Unicode ligatures to ASCII (ﬁ → fi, ﬂ → fl, etc.)
- **Punctuation Enhancement**: Adds natural pauses for better speech flow
- **Asterisk Removal**: Strips markdown-style emphasis markers

## Configuration

### Customizing eSpeak Settings

You can modify the eSpeak parameters by editing the `read-aloud-from-cursor-espeak` function:

```elisp
(setq read-aloud-process
      (start-process "espeak-process" nil "/usr/bin/espeak"
                    "-s" "200"    ; Speed (words per minute)
                    "-v" "en+f3"  ; Voice variant
                    "-p" "50"     ; Pitch
                    text))
```

### Customizing Edge TTS Voice

Edit the voice in `read-aloud-with-edge-tts`:

```elisp
(voice "en-US-AriaNeural")  ; Change to your preferred voice
```

Available voices include:
- `en-US-JennyNeural` (default)
- `en-US-AriaNeural`
- `en-US-GuyNeural`
- `en-GB-SoniaNeural`
- And many more (run `edge-tts --list-voices` to see all)

### Custom Key Bindings

```elisp
;; Use different keys
(global-set-key (kbd "C-c s") 'my/toggle-read-aloud-espeak)
(global-set-key (kbd "C-c S") 'my/toggle-read-aloud-fancy)

;; Add manual stop command
(global-set-key (kbd "C-c x") 'stop-reading-aloud)
```

## Troubleshooting

### No Audio Output
1. Verify your audio player works: `paplay /usr/share/sounds/alsa/Front_Left.wav`
2. Check eSpeak installation: `espeak "test"`
3. For Edge TTS, verify: `edge-tts --text "test" --write-media test.wav`

### PDF Reading Issues
- Ensure you have `pdf-tools` installed and configured
- Some PDFs may not extract text properly due to formatting

### Text Processing Issues
If text sounds garbled:
- Check for Unicode characters that might need normalization
- Adjust the text cleaning functions for your specific use case

## Dependencies

- **Emacs 24.3+** (lexical binding support)
- **eSpeak** (text-to-speech engine)
- **pdf-tools** (optional, for PDF support)
- **edge-tts** (optional, for high-quality voices)

## License

This package is provided as-is for personal use. Feel free to modify and distribute according to your needs.

## Contributing

Suggestions and improvements are welcome! This package is designed to be lightweight and focused on core text-to-speech functionality.
